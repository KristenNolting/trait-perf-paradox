3005-1202-88
1150+155+70+70+15+15+10+50+120
300*36
2795+3172
Disc <- 4484
5967-4484
Rent <- 1162
5967-Disc-Rent
321-156
library(tidyverse)
rm(list = ls())
# Read in full dataframe (from Nolting et al. 2020)
full_data <- read.csv("/Users/knolting/Documents/UConn_Projects/MW2PAC/Data/Individual_Data_for_Analysis.csv", na.strings = ".")
# Drop populations not used, create variable for Instantaneous WUE, select relevant columns
subset_data <- full_data %>%
filter(Species != "LDSA") %>%
filter(Site != "McGregor") %>%
filter(Site != "Jonaskop_2") %>%
mutate(WUE_Instantaneous = Photo/Trmmol) %>%
select(Species, Site, Ind_No, Age, Height_in, Canopy_area_in2, Total_Fruit_No, HV_m2_cm2, WD,
Ks, KL_Units, TotalAssim, BW_dry_avg, Photo, Trmmol, Cond, WUE_Intrinsic,
Thick_cm, Area_cm2, LMA_g.cm2, LWR, LD_g.cm3, Length_mm_Top, Density_mm2_Top,
SPI_Top, WUE_Instantaneous) %>%
drop_na()
# Dropping the Cederberg, Protea repens population
subset_data$keep <- "yes"
subset_data$keep[subset_data$Site == "Cederberg" & subset_data$Species == "PRRE"] <- "no"
Protea_data <- subset_data %>%
filter(keep == "yes") %>%
droplevels()
# check
Protea_data[Protea_data$Site == "Cederberg" & Protea_data$Species == "PRRE",]
# This centers the trait data at zero and scales it by 1 standard deviation
Protea_data <- Protea_data %>%
mutate(
BW_scaled = scale(BW_dry_avg),
WD_scaled = scale(WD),
Leaf_Area_scaled = scale(Area_cm2),
LMA_scaled = scale(LMA_g.cm2),
LD_scaled = scale(LD_g.cm3),
LWR_scaled = scale(LWR),
Stom_L_scaled = scale(Length_mm_Top),
Stom_D_scaled = scale(Density_mm2_Top),
SPI_scaled = scale(SPI_Top),
Ks_scaled = scale(Ks),
LSC_scaled = scale(KL_Units),
Photo_scaled = scale(Photo),
Total_Assim_scaled = scale(TotalAssim),
Cond_scaled = scale(Cond),
WUE_Instan_scaled = scale(WUE_Instantaneous),
Height_scaled = scale(Height_in),
Canopy_scaled = scale(Canopy_area_in2)
)
dim(Protea_data)
save(Protea_data, file = "/Data/Protea_data.RData")
getwd()
setwd("~/Documents/GitHub/trait-perf-paradox")
getwd()
# load libraries
library(brms)
library(tidyverse)
library(ggplot2)
library(cowplot)
library(tidybayes)
# optimize computing
options(mc.cores = parallel::detectCores())
# load Protea_data if not loaded
load("Data/Protea_data.RData")
# 1. Bark Width (BW)
BW_var <- brm(BW_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/BW_var")
BW_var_df <- as.data.frame(BW_var)
BW_among_var <- apply(BW_var_df[,5:9], 1, var)
BW_within_var <- (BW_var_df$sigma)^2
BW_among_var_percent <- (BW_among_var/(BW_among_var + BW_within_var))*100
quantile(BW_among_var_percent, probs = c(0.5))
# 2. Wood Density (WD)
WD_var <- brm(WD_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/WD_var")
WD_var_df <- as.data.frame(WD_var)
WD_among_var <- apply(WD_var_df[,5:9], 1, var)
WD_within_var <- (WD_var_df$sigma)^2
WD_among_var_percent <- (WD_among_var/(WD_among_var + WD_within_var))*100
# 3. Leaf Area (Leaf_Area)
LA_var <- brm(Leaf_Area_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/LA_var")
LA_var_df <- as.data.frame(LA_var)
LA_among_var <- apply(LA_var_df[,5:9], 1, var)
LA_within_var <- (LA_var_df$sigma)^2
LA_among_var_percent <- (LA_among_var/(LA_among_var + LA_within_var))*100
# 4. Leaf Mass per Area (LMA)
LMA_var <- brm(LMA_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/LMA_var")
LMA_var_df <- as.data.frame(LMA_var)
LMA_among_var <- apply(LMA_var_df[,5:9], 1, var)
LMA_within_var <- (LMA_var_df$sigma)^2
LMA_among_var_percent <- (LMA_among_var/(LMA_among_var + LMA_within_var))*100
# 5. Lamina Density (LD)
LD_var <- brm(LD_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/LD_var")
LD_var_df <- as.data.frame(LD_var)
LD_among_var <- apply(LD_var_df[,5:9], 1, var)
LD_within_var <- (LD_var_df$sigma)^2
LD_among_var_percent <- (LD_among_var/(LD_among_var + LD_within_var))*100
# 6. Leaf LWR (LWR)
LWR_var <- brm(LWR_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/LWR_var")
LWR_var_df <- as.data.frame(LWR_var)
LWR_among_var <- apply(LWR_var_df[,5:9], 1, var)
LWR_within_var <- (LWR_var_df$sigma)^2
LWR_among_var_percent <- (LWR_among_var/(LWR_among_var + LWR_within_var))*100
# 7. Stomatal Length (StomL)
StomL_var <- brm(Stom_L_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/StomL_var")
StomL_var_df <- as.data.frame(StomL_var)
StomL_among_var <- apply(StomL_var_df[,5:9], 1, var)
StomL_within_var <- (StomL_var_df$sigma)^2
StomL_among_var_percent <- (StomL_among_var/(StomL_among_var + StomL_within_var))*100
# 8. Stomatal Density (StomD)
StomD_var <- brm(Stom_D_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/StomD_var")
StomD_var_df <- as.data.frame(StomD_var)
StomD_among_var <- apply(StomD_var_df[,5:9], 1, var)
StomD_within_var <- (StomD_var_df$sigma)^2
StomD_among_var_percent <- (StomD_among_var/(StomD_among_var + StomD_within_var))*100
# Make a dataframe for plotting
Str_Trait_Var <- cbind(BW_among_var_percent, WD_among_var_percent,
LA_among_var_percent, LMA_among_var_percent,
LD_among_var_percent, LWR_among_var_percent,
StomL_among_var_percent, StomD_among_var_percent)
Str_Trait_Var <- as.data.frame(Str_Trait_Var)
Str_Trait_Var_df <- pivot_longer(data = Str_Trait_Var,
cols = everything(),
names_to = "Structural_Trait",
values_to = "Among_Var")
head(Str_Trait_Var_df)
dim(Str_Trait_Var_df)
# 1. Hydraulic Conductivity (Ks)
Ks_var <- brm(Ks_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/Ks_var")
Ks_var_df <- as.data.frame(Ks_var)
Ks_among_var <- apply(Ks_var_df[,5:9], 1, var)
Ks_within_var <- (Ks_var_df$sigma)^2
Ks_among_var_percent <- (Ks_among_var/(Ks_among_var + Ks_within_var))*100
# 2. Leaf Specific Conductivity (LSC)
LSC_var <- brm(LSC_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/LSC_var")
LSC_var_df <- as.data.frame(LSC_var)
LSC_among_var <- apply(LSC_var_df[,5:9], 1, var)
LSC_within_var <- (LSC_var_df$sigma)^2
LSC_among_var_percent <- (LSC_among_var/(LSC_among_var + LSC_within_var))*100
# 3. Photosynthetic Rate (Photo)
Photo_var <- brm(Photo_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/Photo_var")
Photo_var_df <- as.data.frame(Photo_var)
Photo_among_var <- apply(Photo_var_df[,5:9], 1, var)
Photo_within_var <- (Photo_var_df$sigma)^2
Photo_among_var_percent <- (Photo_among_var/(Photo_among_var + Photo_within_var))*100
# 4. Total Assimilation (Total_Assim)
LSP_var <- brm(Total_Assim_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/LSP_var")
LSP_var_df <- as.data.frame(LSP_var)
LSP_among_var <- apply(LSP_var_df[,5:9], 1, var)
LSP_within_var <- (LSP_var_df$sigma)^2
LSP_among_var_percent <- (LSP_among_var/(LSP_among_var + LSP_within_var))*100
# 5. Stomatal Conductance (Cond)
Cond_var <- brm(Cond_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/Cond_var")
Cond_var_df <- as.data.frame(Cond_var)
Cond_among_var <- apply(Cond_var_df[,5:9], 1, var)
Cond_within_var <- (Cond_var_df$sigma)^2
Cond_among_var_percent <- (Cond_among_var/(Cond_among_var + Cond_within_var))*100
# 6. Instantaneous Water Use Efficiency (WUE_Instan)
WUE_Instan_var <- brm(WUE_Instan_scaled ~ 1 + (1|Species),
data = Protea_data,
family = gaussian(link = "identity"),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 5), class = sd)),
control = list(adapt_delta = 0.99, max_treedepth = 12),
save_pars = save_pars(all = TRUE),
iter = 4000, warmup = 2000, chains = 4,
file = "Output/Model_Fits/WUE_Instan_var")
WUE_Instan_var_df <- as.data.frame(WUE_Instan_var)
WUE_Instan_among_var <- apply(WUE_Instan_var_df[,5:9], 1, var)
WUE_Instan_within_var <- (WUE_Instan_var_df$sigma)^2
WUE_Instan_among_var_percent <- (WUE_Instan_among_var/(WUE_Instan_among_var + WUE_Instan_within_var))*100
mean(WUE_Instan_among_var_percent)
mean(Cond_among_var_percent)
mean(LSP_among_var_percent)
mean(Photo_among_var_percent)
mean(LSC_among_var_percent)
mean(Ks_among_var_percent)
mean(WD_among_var_percent)
mean(StomL_among_var_percent)
mean(StomD_among_var_percent)
mean(LWR_among_var_percent)
mean(LMA_among_var_percent)
mean(LD_among_var_percent)
mean(LA_among_var_percent)
mean(BW_among_var_percent)
3196-156-745
2295-1755
540+745
195/3
